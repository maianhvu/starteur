$(function() {

  // Set Stripe handler
  var handler = StripeCheckout.configure({
    key: 'pk_test_CVZM4RivH5GBnvVIgT3sgVmD',
    image: "<%= image_url('shared/acorn.png') %>",
    locale: 'auto',
    token: function(token) {
      // Use the token to create the charge with a server-side script.
      // You can access the token ID with `token.id`
    },
    email: currentUserEmail,
    allowRememberMe: true
  });

  $('#purchaseTestButton').on('click', function(e) {
    // Open Checkout with further options
    handler.open({
      name: 'Starteur Profiling Tests',
      description: 'Discover your entrepreneurial traits',
      currency: "sgd",
      amount: 1000 // Change to dynamic value from database
    });
    e.preventDefault();
  });

  // Close Checkout on page navigation
  $(window).on('popstate', function() {
    handler.close();
  });
});
